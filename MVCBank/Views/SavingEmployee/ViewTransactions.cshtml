@{
    ViewBag.Title = "Savings - View Transactions";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

<h2>View Transactions</h2>

@Html.ValidationSummary(true, "", new { @class = "text-danger" })

<form method="post" action="@Url.Action("ViewTransactions", "SavingEmployee")">
    @Html.AntiForgeryToken()

    <div class="mb-3" style="max-width:300px;">
        <label class="form-label">Account Type</label>
        <select name="accountType" class="form-control">
            <option value="SAVINGS">Savings</option>
            <option value="FD">Fixed Deposit</option>
        </select>
    </div>

    <div class="mb-3" style="max-width:400px;">
        <label class="form-label">Account ID</label>
        <input type="text" name="accountId" class="form-control" placeholder="Enter account id e.g. SB00001 or FD00001" />
    </div>

    <button type="submit" class="btn btn-primary">Load Transactions</button>
</form>

@if (ViewBag.Transactions != null)
{
    <h4 class="mt-4">Transactions for @ViewBag.AccountType - @((ViewBag.Account != null) ? (ViewBag.Account.SBAccountID ?? ViewBag.Account.FDAccountID) : "")</h4>

    @{ var txns = ViewBag.Transactions as IEnumerable<dynamic>; }

    @if (txns != null && txns.Any())
    {
        <table class="table table-striped mt-2">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Amount</th>
                    <th>Balance/Outstanding</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var t in txns)
            {
                <tr>
                    <td>@(t.TransactionDate?.ToString("yyyy-MM-dd HH:mm") ?? "")</td>
                    <td>@(t.TransactionType ?? t.FDType ?? "")</td>
                    <td>@String.Format("{0:N2}", t.Amount)</td>
                    <td>@(t.Outstanding != null ? String.Format("{0:N2}", t.Outstanding) : (t.Balance != null ? String.Format("{0:N2}", t.Balance) : ""))</td>
                </tr>
            }
            </tbody>
        </table>
    }
    else
    {
        <div class="alert alert-info mt-3">No transactions found for this account.</div>
    }
}
else if (!String.IsNullOrEmpty(ViewBag.SuccessMessage))
{
    <div class="alert alert-success mt-3">@ViewBag.SuccessMessage</div>
}