@{
    ViewBag.Title = "Savings - View Transactions";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

<h2>View Transactions</h2>

@Html.ValidationSummary(true, "", new { @class = "text-danger" })

<form method="post" action="@Url.Action("ViewTransactions", "SavingEmployee")">
    @Html.AntiForgeryToken()

    <div class="mb-3" style="max-width:300px;">
        <label class="form-label">Account Type</label>
        <select name="accountType" class="form-control">
            <option value="SAVINGS">Savings</option>
            <option value="FD">Fixed Deposit</option>
        </select>
    </div>

    <div class="mb-3" style="max-width:400px;">
        <label class="form-label">Account ID</label>
        <input type="text" name="accountId" class="form-control" placeholder="Enter account id e.g. SB00001 or FD00001" />
    </div>

    <button type="submit" class="btn btn-primary">Load Transactions</button>
</form>

@{
    var accType = ViewBag.AccountType as string;
}

@if (ViewBag.Transactions != null && !string.IsNullOrEmpty(accType))
{
    string accountId = string.Empty;
    if (accType == "SAVINGS")
    {
        var acc = ViewBag.Account as MVCBank.Models.SavingsAccount;
        if (acc != null) { accountId = acc.SBAccountID; }

        <h4 class="mt-4">Transactions for Savings - @accountId</h4>

        var txns = ViewBag.Transactions as IEnumerable<MVCBank.Models.SavingsTransaction>;
        if (txns != null && txns.Any())
        {
            <table class="table table-striped mt-2">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody>
                @foreach (var t in txns)
                {
                    <tr>
                        <td>@(t.TransactionDate.HasValue ? t.TransactionDate.Value.ToString("yyyy-MM-dd HH:mm") : "")</td>
                        <td>@t.TransactionType</td>
                        <td>@String.Format("{0:N2}", t.Amount)</td>
                    </tr>
                }
                </tbody>
            </table>
        }
        else
        {
            <div class="alert alert-info mt-3">No transactions found for this account.</div>
        }
    }
    else if (accType == "FD")
    {
        var acc = ViewBag.Account as MVCBank.Models.FixedDepositAccount;
        if (acc != null) { accountId = acc.FDAccountID; }

        <h4 class="mt-4">Transactions for Fixed Deposit - @accountId</h4>

        var txns = ViewBag.Transactions as IEnumerable<MVCBank.Models.FDTransaction>;
        if (txns != null && txns.Any())
        {
            <table class="table table-striped mt-2">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody>
                @foreach (var t in txns)
                {
                    <tr>
                        <td>@(t.TransactionDate.HasValue ? t.TransactionDate.Value.ToString("yyyy-MM-dd HH:mm") : "")</td>
                        <td>@t.FDType</td>
                        <td>@(t.Amount.HasValue ? String.Format("{0:N2}", t.Amount.Value) : "")</td>
                    </tr>
                }
                </tbody>
            </table>
        }
        else
        {
            <div class="alert alert-info mt-3">No transactions found for this account.</div>
        }
    }
}
else if (!String.IsNullOrEmpty(ViewBag.SuccessMessage))
{
    <div class="alert alert-success mt-3">@ViewBag.SuccessMessage</div>
}